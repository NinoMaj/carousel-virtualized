"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),lodash=require("lodash"),PropTypes=require("prop-types"),React=require("react"),reactWindow=require("react-window"),RESIZE_THROTTLE_THRESHOLD=500;!function(e){e[e.Left=-1]="Left",e[e.Right=1]="Right"}(exports.Direction||(exports.Direction={})),function(e){e.Initial="initial",e.LeftArrowClick="leftarrowclick",e.KeyDown="keydown",e.MouseClick="mouseclick",e.MouseDrag="mousedrag",e.Resize="resize",e.RightArrowClick="rightarrowclick",e.TouchDrag="touchdrag"}(exports.EventName||(exports.EventName={})),function(e){e[e.LeftArrow=37]="LeftArrow",e[e.RightArrow=39]="RightArrow"}(exports.KeyboardButton||(exports.KeyboardButton={}));var Carousel=function(t){function o(e){var s=t.call(this,e)||this;return s.moveTimer=null,s.containerRef=null,s.carouselRef=React.createRef(),s.throttledResize=lodash.throttle(function(){s.containerRef&&s.setState({eventName:exports.EventName.Resize,height:s.containerRef.offsetHeight,width:s.containerRef.offsetWidth},function(){return s.carouselRef.current&&s.carouselRef.current.scrollToItem(s.state.currentIndex,"center")})},RESIZE_THROTTLE_THRESHOLD,{leading:!1,trailing:!0}),s.setContainerRef=function(e){s.containerRef=e},s.onResize=function(){s.throttledResize()},s.handleOnKeyDown=function(e){e.preventDefault(),e.stopPropagation(),e.which!==exports.KeyboardButton.LeftArrow&&e.which!==exports.KeyboardButton.RightArrow||s.changeSlide(e.which===exports.KeyboardButton.LeftArrow?exports.Direction.Left:exports.Direction.Right,exports.EventName.KeyDown)},s.handleOnMouseDown=function(e){e.stopPropagation(),s.props.disableDrag||(e.preventDefault(),s.onDragStart(e.screenX,!0,!1))},s.handleOnMouseMove=function(e){!s.props.disableDrag&&s.state.isMouseDragActive&&(e.preventDefault(),e.persist(),s.onDragMove(e.screenX))},s.handleOnMouseClick=function(e){!s.props.disableDrag&&s.state.isMouseDragActive&&(s.state.mouseIsMoving&&e.preventDefault(),s.onDragEnd("mouseDrag"))},s.handleTouchStart=function(e){if(!s.props.disableTouch){var t=e.targetTouches[0];s.onDragStart(t.screenX,!1,!0)}},s.handleTouchMove=function(e){if(!s.props.disableTouch){window.cancelAnimationFrame.call(window,s.moveTimer);var t=e.targetTouches[0];s.onDragMove(t.screenX)}},s.handleTouchEnd=function(){s.endTouchMove()},s.handleTouchCancel=function(){s.endTouchMove()},s.onItemsRendered=function(r){return function(e){var t=e.overscanStartIndex,o=e.overscanStopIndex,n=e.visibleStartIndex,i=e.visibleStopIndex;return s.props.onItemsRendered&&s.props.onItemsRendered({carouselName:r||s.props.carouselName,eventName:s.state.eventName,overscanStartIndex:t,overscanStopIndex:o,visibleStartIndex:n,visibleStopIndex:i})}},s.state={currentIndex:s.props.currentIndex||0,deltaX:0,eventName:exports.EventName.Initial,height:0,isMounted:!1,isMouseDragActive:!1,isTouchDragActive:!1,mouseIsMoving:!1,startX:0,startY:0,width:0},s}return tslib_1.__extends(o,t),o.slidesMoved=function(e,t){var o=Math.abs(Math.round(e/t)),n=Math.abs(e)>=.1*t?1:0;return e<0?Math.max(n,o):-Math.max(o,n)},o.prototype.componentDidMount=function(){this.containerRef&&this.setState({height:this.containerRef.offsetHeight,isMounted:!0,width:this.containerRef.offsetWidth}),this.props.autofocus&&this.containerRef&&this.containerRef.focus(),window.addEventListener("resize",this.onResize)},o.prototype.componentDidUpdate=function(e){this.props.currentIndex&&e.currentIndex!==this.props.currentIndex&&this.setState({currentIndex:this.props.currentIndex})},o.prototype.componentWillUnmount=function(){window.removeEventListener("resize",this.onResize),window.cancelAnimationFrame.call(window,this.moveTimer),this.moveTimer=null},o.prototype.render=function(){var e=this.props,t=e.children,o=(e.outerClassName,e.height,e.itemCount),n=(e.outerStyle,e.width,this.itemSize()&&this.props.slideCount?this.itemSize()*this.props.slideCount:this.state.width),i=this.itemSize()||this.state.width*this.state.currentIndex;return t({enableKeyboard:{onKeyDown:this.handleOnKeyDown},enableMouse:{onClick:this.handleOnMouseClick,onMouseDown:this.handleOnMouseDown,onMouseMove:this.handleOnMouseMove},enableTouch:{onTouchCancel:this.handleTouchCancel,onTouchEnd:this.handleTouchEnd,onTouchMove:this.handleTouchMove,onTouchStart:this.handleTouchStart},sliderProps:{carouselRef:this.carouselRef,currentIndex:this.state.currentIndex,height:this.state.height,initialScrollOffset:i,isMounted:this.state.isMounted,itemCount:o,itemSize:this.itemSize(),onItemsRendered:this.onItemsRendered,setContainerRef:this.setContainerRef,style:{overflow:"hidden"},width:n}})},o.prototype.itemSize=function(){return this.props.slideCount?this.state.width/this.props.slideCount:this.state.width},o.prototype.endTouchMove=function(){this.props.disableTouch||this.onDragEnd("touchDrag")},o.prototype.onDragStart=function(e,t,o){window.cancelAnimationFrame.call(window,this.moveTimer),this.setState({isMouseDragActive:t,isTouchDragActive:o,startX:e})},o.prototype.onDragMove=function(t){var e=this;this.moveTimer=window.requestAnimationFrame.call(window,function(){e.setState(function(e){return{deltaX:t-e.startX,mouseIsMoving:e.isMouseDragActive}})})},o.prototype.onDragEnd=function(e){window.cancelAnimationFrame.call(window,this.moveTimer),this.computeNextSlide(),this.setState({deltaX:0,eventName:e,isMouseDragActive:!1,isTouchDragActive:!1,mouseIsMoving:!1})},o.prototype.computeNextSlide=function(){var e=o.slidesMoved(this.state.deltaX,this.itemSize());this.changeSlide(e,this.state.eventName)},o.prototype.changeSlide=function(e,t){var o,n=this.props.itemCount,i=this.state.currentIndex+e;o=n<=i?0:i<0?n-1:i,this.setState({currentIndex:o,eventName:t})},o.propTypes={autofocus:PropTypes.bool,carouselName:PropTypes.string,children:PropTypes.func.isRequired,currentIndex:PropTypes.number,disableDrag:PropTypes.bool,disableTouch:PropTypes.bool,height:PropTypes.oneOfType([PropTypes.string,PropTypes.number]),initialScrollOffset:PropTypes.number,innerClassName:PropTypes.bool,itemCount:PropTypes.number.isRequired,itemData:PropTypes.any,itemSize:PropTypes.number,onItemsRendered:PropTypes.func,outerClassName:PropTypes.string,outerStyle:PropTypes.object,overscanCount:PropTypes.number,slideCount:PropTypes.number,style:PropTypes.object,width:PropTypes.number},o.defaultProps={autofocus:!1,carouselName:"",currentIndex:0,disableDrag:!1,disableTouch:!1,height:null,initialScrollOffset:0,innerClassName:null,itemData:null,itemSize:null,onItemsRendered:function(){},outerClassName:null,outerStyle:{},overscanCount:1,slideCount:null,style:{},width:null},o}(React.Component);!function(e){e.Start="start",e.Center="center",e.End="end"}(exports.Alignment||(exports.Alignment={})),(exports.ArrowStep||(exports.ArrowStep={})).All="ALL";var Easing={EaseInQuad:function(e){return e*e},EaseOutQuad:function(e){return e*(2-e)},EaseInCubic:function(e){return e*e*e},EaseInOutQuad:function(e){return e<.5?2*e*e:(4-2*e)*e-1},EaseOutCubic:function(e){return--e*e*e+1},EaseInOutCubic:function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},EaseInQuart:function(e){return e*e*e*e},EaseOutQuart:function(e){return 1- --e*e*e*e},EaseInOutQuart:function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e},EaseInQuint:function(e){return e*e*e*e*e},EaseOutQuint:function(e){return 1+--e*e*e*e*e},EaseInOutQuint:function(e){return e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e},Linear:function(e){return e}},CarouselVirtualized=function(t){function s(e){var r=t.call(this,e)||this;return r.moveTimer=null,r.containerRef=null,r.carouselRef=React.createRef(),r.scrollOffsetInitial=0,r.scrollOffsetFinal=0,r.animationStartTime=0,r.throttledResize=lodash.throttle(function(){return r.onResize()},RESIZE_THROTTLE_THRESHOLD,{leading:!1,trailing:!0}),r.setContainerRefs=function(e){var t=r.props.outerRef;r.containerRef=e,"function"==typeof t?t(e):null!==t&&"object"==typeof t&&t.hasOwnProperty("current")&&(t.current=e)},r.onResize=function(){r.containerRef&&r.setState({containerHeight:r.containerRef.offsetHeight,containerWidth:r.containerRef.offsetWidth,eventName:exports.EventName.Resize},function(){return r.scrollToItem(r.props.currentIndex||0)})},r.onThrottleResize=function(){r.throttledResize()},r.onScroll=function(e){var t=e.scrollOffset;e.scrollUpdateWasRequested||(r.scrollOffsetInitial=t)},r.handleKeyDown=function(e){e.which!==exports.KeyboardButton.LeftArrow&&e.which!==exports.KeyboardButton.RightArrow||r.onEvent(e.which===exports.KeyboardButton.LeftArrow?exports.Direction.Left:exports.Direction.Right,exports.EventName.KeyDown)},r.handleOnDragStart=function(e){e.stopPropagation(),r.props.disableMouseDrag||(e.preventDefault(),r.onDragStart(e.screenX,!0,!1))},r.handleOnMouseMove=function(e){!r.props.disableMouseDrag&&r.state.isMouseDragActive&&(r.state.mouseIsMoving&&e.preventDefault(),r.onDragMove(e.screenX))},r.handleOnMouseUp=function(e){!r.props.disableMouseDrag&&r.state.isMouseDragActive&&r.state.mouseIsMoving&&(e.preventDefault(),r.onDragEnd(exports.EventName.MouseDrag))},r.handleTouchStart=function(e){if(!r.props.disableTouchDrag){var t=e.targetTouches[0];r.onDragStart(t.screenX,!1,!0)}},r.handleTouchMove=function(e){if(!r.props.disableTouchDrag){window.cancelAnimationFrame.call(window,r.moveTimer);var t=e.targetTouches[0];r.onDragMove(t.screenX)}},r.handleTouchEnd=function(){r.endTouchMove(exports.EventName.TouchDrag)},r.handleTouchCancel=function(){r.endTouchMove(exports.EventName.TouchDrag)},r.onItemsRendered=function(e){var t=e.overscanStartIndex,o=e.overscanStopIndex,n=e.visibleStartIndex,i=e.visibleStopIndex;return r.props.onItemsRendered&&r.props.onItemsRendered({carouselName:r.props.carouselName,eventName:r.state.eventName,overscanStartIndex:t,overscanStopIndex:o,visibleStartIndex:n,visibleStopIndex:i})},r.scrollTo=function(e){r.carouselRef.current&&e&&r.carouselRef.current.scrollTo(r.boundScrollPosition(e))},r.handleLeftArrowClick=function(){var e=r.props,t=e.arrowStep,o=void 0===t?1:t,n=e.arrowStepOffset,i=s.slidesMoved({arrowClick:!0,arrowStep:o,arrowStepOffset:void 0===n?0:n,itemSize:r.itemSize,width:r.width});r.onEvent(i*exports.Direction.Left,exports.EventName.LeftArrowClick)},r.handleRightArrowClick=function(){var e=r.props,t=e.arrowStep,o=void 0===t?1:t,n=e.arrowStepOffset,i=s.slidesMoved({arrowClick:!0,arrowStep:o,arrowStepOffset:void 0===n?0:n,itemSize:r.itemSize,width:r.width});r.onEvent(i*exports.Direction.Right,exports.EventName.RightArrowClick)},r.state={containerHeight:0,containerWidth:0,deltaX:0,eventName:exports.EventName.Initial,isMounted:!1,isMouseDragActive:!1,isTouchDragActive:!1,mouseIsMoving:!1,startX:0},r}return tslib_1.__extends(s,t),s.slidesMoved=function(e){var t=e.arrowClick,o=e.arrowStep,n=e.arrowStepOffset,i=void 0===n?0:n,r=e.deltaX,s=void 0===r?0:r,a=e.itemSize,u=e.width,c=void 0===u?0:u;if(t){var p=void 0;switch(o){case exports.ArrowStep.All:p=Math.round(c/a+i);break;default:p=o}return p}var l=Math.abs(Math.round(s/a)),h=Math.abs(s)>=.1*a?1:0;return s<0?Math.max(h,l):-Math.max(l,h)},s.prototype.componentDidMount=function(){var e=this;this.containerRef&&this.setState({containerHeight:this.containerRef.offsetHeight,containerWidth:this.containerRef.offsetWidth,isMounted:!0},function(){e.setInitiallOffset()}),window.addEventListener(exports.EventName.Resize,this.onThrottleResize),this.props.enableKeyboard&&document.addEventListener(exports.EventName.KeyDown,this.handleKeyDown),this.scrollToItem(this.props.currentIndex||0)},s.prototype.componentDidUpdate=function(e){var t=this.props,o=t.currentIndex,n=t.disableAnimation;if(e.currentIndex!==o){if(this.shouldAnimate(n,o,e.currentIndex))return void this.initAnimation();this.scrollToItem(this.props.currentIndex||0)}},s.prototype.componentWillUnmount=function(){window.removeEventListener(exports.EventName.Resize,this.onResize),document.addEventListener(exports.EventName.KeyDown,this.handleKeyDown),window.cancelAnimationFrame.call(window,this.moveTimer),this.moveTimer=null,this.scrollOffsetInitial=0,this.scrollOffsetFinal=0,this.animationStartTime=0},s.prototype.render=function(){var e=this.props,t=e.children,o=e.currentIndex,n=void 0===o?0:o,i=e.outerClassName,r=e.height,s=e.leftArrow,a=e.initialScrollOffset,u=e.innerClassName,c=e.itemCount,p=e.itemData,l=e.itemSize,h=e.overscanCount,d=void 0===h?1:h,f=e.slideCount,m=e.innerStyle,v=e.outerStyle,T=e.rightArrow,g=e.width,w={containerHeight:this.state.containerHeight,containerWidth:this.state.containerWidth,height:r,itemData:p,width:g},y=l||(f?(g||this.state.containerWidth||0)/f:this.state.containerWidth||0),S=r||this.state.containerHeight||0,b=y&&f?y*f:g||this.state.containerWidth||0,x=a||this.itemSize*n;return React.createElement(React.Fragment,null,s&&s({onClick:this.handleLeftArrowClick,currentIndex:n}),React.createElement("div",{className:i,"data-testid":"carouselVirtualizedContainer",draggable:!0,onDragStart:this.handleOnDragStart,onMouseMove:this.handleOnMouseMove,onMouseUp:this.handleOnMouseUp,onTouchCancel:this.handleTouchCancel,onTouchEnd:this.handleTouchEnd,onTouchMove:this.handleTouchMove,onTouchStart:this.handleTouchStart,ref:this.setContainerRefs,role:"listbox",style:tslib_1.__assign({height:r&&"number"==typeof r?"auto":"100%",width:g?"auto":"100%"},v)},this.state.isMounted?React.createElement(reactWindow.FixedSizeList,{className:u,"data-testid":"carouselVirtualized",direction:"horizontal",height:S,initialScrollOffset:x,itemCount:c,itemData:w,itemSize:y,onItemsRendered:this.onItemsRendered,onScroll:this.onScroll,overscanCount:d,ref:this.carouselRef,style:tslib_1.__assign({overflow:"hidden"},m),width:b},t):null),T&&T({onClick:this.handleRightArrowClick,currentIndex:n}))},s.prototype.shouldAnimate=function(e,t,o){if(t&&o){var n=Math.abs(t-o);return Number.isInteger(e)?n<e:!e}},s.prototype.initAnimation=function(){if(!this.animationStartTime){var e=this.props,t=e.alignment,o=void 0===t?exports.Alignment.Center:t,n=e.currentIndex,i=void 0===n?0:n,r=this.calucateAlignmentOffSet(o);this.scrollOffsetFinal=this.boundScrollPosition(i*this.itemSize-r),this.animationStartTime=performance.now(),this.animate()}},s.prototype.animate=function(){var l=this;requestAnimationFrame(function(){var e=l.props,t=e.animationDuration,o=void 0===t?500:t,n=e.easing,i=void 0===n?Easing.EaseInOutQuint:n,r=e.onAnimationComplete,s=void 0===r?function(){}:r,a=performance.now()-l.animationStartTime,u=l.scrollOffsetFinal-l.scrollOffsetInitial,c=i(Math.min(1,a/o)),p=l.scrollOffsetInitial+u*c;l.scrollTo(p),a<o?l.animate():(l.animationStartTime=0,l.scrollOffsetInitial=l.scrollOffsetFinal,s())})},s.prototype.calucateAlignmentOffSet=function(e){if(this.width===this.itemSize)return 0;var t;switch(e){case exports.Alignment.Start:t=0;break;case exports.Alignment.Center:t=this.width/2;break;case exports.Alignment.End:t=this.width-this.itemSize;break;default:t=0}return t},s.prototype.setInitiallOffset=function(){if(this.props.alignment){var e=this.calucateAlignmentOffSet(this.props.alignment);this.scrollTo((this.props.currentIndex||0)*this.itemSize-e)}},s.prototype.endTouchMove=function(e){this.props.disableTouchDrag||this.onDragEnd(e)},s.prototype.onDragStart=function(e,t,o){window.cancelAnimationFrame.call(window,this.moveTimer),this.setState({isMouseDragActive:t,isTouchDragActive:o,startX:e})},s.prototype.onDragMove=function(t){var e=this;this.moveTimer=window.requestAnimationFrame.call(window,function(){e.setState(function(e){return{deltaX:t-e.startX,mouseIsMoving:e.isMouseDragActive}})})},s.prototype.onDragEnd=function(e){window.cancelAnimationFrame.call(window,this.moveTimer),this.computeNextSlide(e),this.setState({deltaX:0,eventName:e,isMouseDragActive:!1,isTouchDragActive:!1,mouseIsMoving:!1})},s.prototype.computeNextSlide=function(e){var t=s.slidesMoved({arrowClick:!1,deltaX:this.state.deltaX,itemSize:this.itemSize});this.onEvent(t,e)},s.prototype.boundScrollPosition=function(e){this.props.currentIndex;return e<0?0:e>this.props.itemCount*this.itemSize-this.width?this.props.itemCount*this.itemSize-this.width:e},s.prototype.boundIndex=function(e){var t=this.props,o=t.itemCount,n=t.wrapAround;return o<=e?n?0:o-1:e<0?n?o-1:0:e},s.prototype.onEvent=function(e,t){var o=this.props,n=o.currentIndex,i=void 0===n?0:n,r=o.onEvent,s=i+e;(void 0===r?function(){}:r)({newIndex:this.boundIndex(s),eventName:t})},s.prototype.scrollToItem=function(e){var t=this.props.alignment,o=void 0===t?exports.Alignment.Center:t;this.carouselRef.current&&this.carouselRef.current.scrollToItem(this.boundIndex(e),o)},Object.defineProperty(s.prototype,"width",{get:function(){return this.itemSize&&this.props.slideCount?this.itemSize*this.props.slideCount:this.props.width||this.state.containerWidth||0},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"itemSize",{get:function(){var e=this.props,t=e.itemSize,o=e.width,n=e.slideCount;return t||(n?(o||this.state.containerWidth||0)/n:this.state.containerWidth||0)},enumerable:!0,configurable:!0}),s.propTypes={alignment:PropTypes.string,animationDuration:PropTypes.number,arrowStep:PropTypes.oneOfType([PropTypes.string,PropTypes.number]),arrowStepOffset:PropTypes.number,carouselName:PropTypes.string,children:PropTypes.func.isRequired,currentIndex:PropTypes.number,disableAnimation:PropTypes.oneOfType([PropTypes.bool,PropTypes.number]),disableMouseDrag:PropTypes.bool,disableTouchDrag:PropTypes.bool,easing:PropTypes.func,enableKeyboard:PropTypes.bool,height:PropTypes.oneOfType([PropTypes.string,PropTypes.number]),initialScrollOffset:PropTypes.number,innerClassName:PropTypes.bool,innerStyle:PropTypes.object,itemCount:PropTypes.number.isRequired,itemData:PropTypes.any,itemSize:PropTypes.number,leftArrow:PropTypes.func,onAnimationComplete:PropTypes.func,onEvent:PropTypes.func,onItemsRendered:PropTypes.func,outerClassName:PropTypes.string,outerRef:PropTypes.oneOfType([PropTypes.func,PropTypes.object]),outerStyle:PropTypes.object,overscanCount:PropTypes.number,rightArrow:PropTypes.func,slideCount:PropTypes.number,width:PropTypes.number,wrapAround:PropTypes.bool},s.defaultProps={alignment:exports.Alignment.Center,animationDuration:500,arrowStep:1,arrowStepOffset:0,carouselName:"",currentIndex:0,disableAnimation:!1,disableMouseDrag:!1,disableTouchDrag:!1,easing:Easing.EaseInOutQuint,enableKeyboard:!1,height:0,initialScrollOffset:0,innerClassName:void 0,innerStyle:{},itemData:void 0,itemSize:void 0,leftArrow:function(){},onAnimationComplete:function(){},onEvent:function(){},onItemsRendered:function(){},outerClassName:void 0,outerRef:void 0,outerStyle:{},overscanCount:1,rightArrow:function(){},slideCount:void 0,width:void 0,wrapAround:!1},s}(React.PureComponent),Slider=function(t){function e(e){return t.call(this,e)||this}return tslib_1.__extends(e,t),e.prototype.componentDidUpdate=function(e){this.props.currentIndex&&e.currentIndex!==this.props.currentIndex&&this.scrollToItem(this.props.currentIndex)},e.prototype.render=function(){return React.createElement("div",{className:this.props.outerClassName,onClick:this.props.onMouseClick,onKeyDown:this.props.onKeyDown,onMouseDown:this.props.onMouseDown,onMouseMove:this.props.onMouseMove,onTouchCancel:this.props.onTouchCancel,onTouchEnd:this.props.onTouchEnd,onTouchMove:this.props.onTouchMove,onTouchStart:this.props.onTouchStart,ref:this.props.setContainerRef,role:"listbox",style:{height:this.props.height||"100%",width:this.props.width||"100%"}},this.props.isMounted?React.createElement(reactWindow.FixedSizeList,{className:this.props.innerClassName,direction:"horizontal",height:this.props.height,initialScrollOffset:this.props.initialScrollOffset,itemCount:this.props.itemCount,itemData:this.props.itemData,itemSize:this.props.itemSize,onItemsRendered:this.props.onItemsRendered&&this.props.onItemsRendered("main"),overscanCount:this.props.overscanCount,style:this.props.style,width:this.props.width,ref:this.props.carouselRef},this.props.children):null)},e.prototype.scrollToItem=function(e){this.props.carouselRef.current&&this.props.carouselRef.current.scrollToItem(e,"center")},e}(React.Component);exports.Carousel=Carousel,exports.Slider=Slider,exports.CarouselVirtualized=CarouselVirtualized;
